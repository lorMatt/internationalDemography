---
title: "Umbria"
subtitle: 'Principali indicatori demografici'
lang: 'it'
author:
  - name: 'Lorenzo Mattioli'
    affiliations:
     - name: 'Alma Mater Studiorum - Università di Bologna'
       department: 'Dipartimento di Scienze Politiche e Sociali - SPS'
toc: true
toc-expand: 2
format:
  html:
    repo: 'https://github.com/lorMatt/internationalDemography.git'
    code-tools: true
    self-contained: true
    code-fold: true
editor: visual
execute: 
  warning: false
code-fold: true
fig-width: 12
fig-asp: 0.4
---

```{r}
#| label: Setup
#| echo: false
# Pacchetti
if (!require("pacman")) install.packages("pacman")
library(pacman)
p_load(ggplot2, tidyverse, readxl, patchwork, ggiraph, ggbump, gt, gtExtras)

# Importazione dati
## Età per sesso
it00 <- readRDS('Dati/Export/it00.rds')
it24 <- readRDS('Dati/Export/it24.rds')
um00 <- readRDS('Dati/Export/um00.rds')
um24 <- readRDS('Dati/Export/um24.rds')
etadf <- readRDS('Dati/Export/etadf.rds')
FX <- readRDS('Dati/Export/FX.rds')

## Indicatori
inddf <- readRDS('Dati/Export/inddf.rds')

## Fecondità
fecdf <- readRDS('Dati/Export/fecdf.rds')

## Mortalità
umbMort <- readRDS('Dati/Export/umbMort.rds')
```

## Introduzione

882.015 residenti al 1° gennaio 2019: 13,8 per cento di 75 anni e più

386.420 famiglie al 31 dicembre 2018: 30 per cento composte da una coppia con figli; 20,1 per cento da persone sole di 60 anni e oltre

14,3 per cento delle famiglie e 16,3 per cento degli individui in condizioni di povertà relativa nel 2018

[@datista]

## Analisi della struttura per età

### Piramidi delle età

L'Umbria è una regione particolarmente anziana. Nel 2000 presentava, infatti, delle proporzioni di popolazione oltre ai 65 anni decisamente maggiori rispetto a quelle riscontrabili nell'interezza della popolazione italiana. Al 2024, la composizione per età della popolazione umbra ricalca più fedelmente quella nazionale, pur presentando uno sbilanciamento maggiore verso le età più avanzate.

```{r}
#| label: Piramidi delle età
#| fig-asp: 1

## Italia ----
### 2024
it24gg <- it24 |> 
  filter(Sesso != 'Totale') |>
  ggplot(aes(x = Età,
             y = ifelse(Sesso == 'M',
                        -`Tot per genere`, `Tot per genere`),
             fill = Sesso)) +
  geom_bar(stat = 'identity', width = 1) +
  coord_flip() +
  # scale_fill_manual(values = c('#EEC584', '#55868C')) +
  labs(title = 'Italia 2024')
  
it00gg <- it00 |> 
  filter(Sesso != 'Totale') |> 
  ggplot(aes(x = Età,
             y = ifelse(Sesso == 'M',
                        -`2000`, `2000`),
             fill = Sesso)) +
  geom_bar(stat = 'identity', width = 1) +
  coord_flip() +
  # scale_fill_manual(values = c('#EEC584', '#55868C')) +
  labs(title = 'Italia 2000')

## Umbria ----
### 2024
um24gg <- um24 |> 
  filter(Sesso != 'Totale') |>
  ggplot(aes(x = Età,
             y = ifelse(Sesso == 'M',
                        -`Tot per genere`, `Tot per genere`),
             fill = Sesso)) +
  geom_bar(stat = 'identity', width = 1) +
  coord_flip() +
  # scale_fill_manual(values = c('#942911', '#90A583')) +
  labs(title = 'Umbria 2024')

um00gg <- um00 |> 
  filter(Sesso != 'Totale') |> 
  ggplot(aes(x = Età,
             y = ifelse(Sesso == 'M',
                        -`2000`, `2000`),
             fill = Sesso)) +
  geom_bar(stat = 'identity', width = 1) +
  coord_flip() +
  # scale_fill_manual(values = c('#942911', '#90A583')) +
  labs(title = 'Umbria 2000')

## Patchwork ----
it00gg + um00gg + it24gg + um24gg +
  plot_layout(guides = 'collect', axes = 'collect') +
  plot_annotation(title = 'Piramidi delle età',
                  caption = 'Dati Demo.Istat',
                  theme = theme(plot.title = element_text(size = 18))) &
  theme(legend.position = 'bottom',
        axis.title.x = element_blank(),
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank(),
        panel.background = element_blank(),
        panel.grid = element_line(colour = 'gray90'),
        legend.title = element_blank(),
        plot.title.position = 'panel')
```

### Indici di popolazione

La marcata anzianità della popolazione umbra può essere facilmente confermata confrontando la sua età media con quella dell'Italia intera nel 2000 e nel 2024: anche a netto di una tendenza generalizzata all'invecchiamento, la differenza tra il valore regionale e la media nazionale rimane sempre positiva. Notevole è però il fatto che l'Umbria sia nell'atto di essere *raggiunta* dal resto del Paese, con una diminuzione della distanza tra i due valori medi da 2.78 a 1.55 anni di età. Si noti che l'età media della popolazione femminile è sempre maggiore di quella maschile. Questo è principalmente dovuto a una maggiore sopravvivenza femminile in età avanzata, come riscontrabile analizzando le piramidi delle età di cui sopra.

```{r}
#| label: barplot età media

girafe(ggobj = etadf |>
  mutate(Anno = anno,
         'Territorio' = geo,
         'Femmine' = round(etaMed_F, 2),
         'Maschi' = round(etaMed_M, 2),
         'Totale' = round(etaMed_Totale, 2),
         'Giovanile' = round(dipGiov, 2),
         'Vecchiaia' = round(dipVec, 2),
         'Complessivo' = round(dip, 2),
         'Indice di vecchiaia' = round(vec, 2),
         'Rapporto di mascolinità' = round(rapMasc, 2)
         ) |> 
  select(Anno, Territorio, Femmine, Maschi, Totale) |> 
  pivot_longer(cols = c(Femmine, Maschi, Totale)) |> 
  ggplot(aes(x = name, y = value, fill = factor(Anno), dataid = value, tooltip = value)) +
  geom_col_interactive(position = 'dodge', width = .6) +
  geom_hline(yintercept = 0) +
  geom_text(aes(y = 2, label = name), hjust = 0, col = 'white') +
  coord_flip() +
  labs(title = 'Età medie',
       caption = 'Dati Demo.Istat') +
  scale_fill_manual(values = c('steelblue', 'deepskyblue4')) +
  scale_y_continuous(expand = c(0, 0)) +
  facet_wrap(~Territorio) +
  theme(legend.position = 'bottom',
        axis.title = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks.y = element_blank(),
        panel.background = element_blank(),
        panel.grid = element_line(colour = 'gray90'),
        legend.title = element_blank(),
        strip.background = element_blank(),
        plot.title.position = 'panel',
        panel.grid.major.x = element_line(color = "#A8BAC4", size = 0.3)),
  options = list(
         opts_tooltip(css = 'background-color:white;
                      color:black;
                      font-family:Helvetica;
                      font-style:empty;
                      padding:8px;
                      border-radius:10px;
                      background:rgba(255, 255, 255, 0.8);'),
         opts_hover(css = ''),
         opts_hover_inv(css = "opacity:0.3;"),
         opts_toolbar(position = 'bottomleft'),
         opts_zoom(min = .7, max = 6)))
```

La composizione per età dell'Umbria ha anche un effetto tangibile sugli indici di dipendenza: se quello giovanile è più basso sia nel 2000 che nel 2024, quello di vecchiaia è sempre superiore all'indice calcolato sulla popolazione nazionale. L'inclemente risultato è quello di un indice di dipendenza complessivo sempre superiore alla media nazionale, con un potenziale effetto deleterio sul tessuto produttivo regionale. L'indice di vecchiaia mostra in maniera ancora più drammatica lo squilibrio tra la popolazione anziana e quella in età pre-lavorativa.

```{r}
#| label: barplot ind dipendenza

girafe(ggobj = etadf |>
  mutate(Anno = anno,
         'Territorio' = geo,
         'Femmine' = round(etaMed_F, 2),
         'Maschi' = round(etaMed_M, 2),
         'Totale' = round(etaMed_Totale, 2),
         'Giovanile' = round(dipGiov, 2),
         'Vecchiaia' = round(dipVec, 2),
         'Complessivo' = round(dip, 2),
         'Indice di vecchiaia' = round(vec, 2),
         'Rapporto di mascolinità' = round(rapMasc, 2)
         ) |> 
  select(Anno, Territorio, Giovanile, Vecchiaia, Complessivo) |> 
  pivot_longer(cols = c(Giovanile, Vecchiaia, Complessivo)) |> 
  ggplot(aes(x = name, y = value, fill = factor(Anno), dataid = value, tooltip = value)) +
  geom_col_interactive(position = 'dodge', width = .6) +
  geom_hline(yintercept = 0) +
  geom_text(aes(y = .02, label = name), hjust = 0, col = 'white') +
  coord_flip() +
  labs(title = 'Indici di indipendenza',
       caption = 'Dati Demo.Istat') +
  scale_fill_manual(values = c('steelblue', 'deepskyblue4')) +
  scale_y_continuous(expand = c(0, 0)) +
  facet_wrap(~Territorio) +
  theme(legend.position = 'bottom',
        axis.title = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks.y = element_blank(),
        panel.background = element_blank(),
        panel.grid = element_line(colour = 'gray90'),
        legend.title = element_blank(),
        strip.background = element_blank(),
        plot.title.position = 'panel',
        panel.grid.major.x = element_line(color = "#A8BAC4", size = 0.3)),
  options = list(
         opts_tooltip(css = 'background-color:white;
                      color:black;
                      font-family:Helvetica;
                      font-style:empty;
                      padding:8px;
                      border-radius:10px;
                      background:rgba(255, 255, 255, 0.8);'),
         opts_hover(css = ''),
         opts_hover_inv(css = "opacity:0.3;"),
         opts_toolbar(position = 'bottomleft'),
         opts_zoom(min = .7, max = 6)))
```

Un'ultima considerazione, interessante se non altro altro a titolo di curiosità, riguarda il rapporto di mascolinità: se è vero che questi cresce quando calcolato sull'interezza della popolazione italiana, bisogna osservare come rimanga sostanzialmente stabile a livello regionale. Il motivo potrebbe essere la maggiore inerzia di una popolazione particolarmente anziana.

```{r}
#| label: Indici

etadf |>
  mutate(Anno = anno,
         'Territorio' = geo,
         'Femmine' = round(etaMed_F, 2),
         'Maschi' = round(etaMed_M, 2),
         'Totale' = round(etaMed_Totale, 2),
         'Giovanile' = round(dipGiov, 2),
         'Vecchiaia' = round(dipVec, 2),
         'Complessivo' = round(dip, 2),
         'Indice di vecchiaia' = round(vec, 2),
         'Rapporto di mascolinità' = round(rapMasc, 2)
         ) |> 
  select(Territorio, Femmine, Maschi, Totale, Giovanile, Vecchiaia, Complessivo, `Indice di vecchiaia`, `Rapporto di mascolinità`) |> 
  gt(rowname_col = 'Territorio') |> 
  tab_stubhead(
    label = 'Anno'
  ) |> 
  tab_row_group(
    label = '2000',
    rows = c(1,3)
  ) |> 
  tab_row_group(
    label = '2024',
    rows = c(2,4)
  ) |> 
  tab_header(
    title = md('## Indici di popolazione'),
    subtitle = md('Per **anno** e **territorio**')
             ) |> 
  tab_spanner(
    label = 'Età media',
    columns = c(Femmine, Maschi, Totale)
  ) |> 
  tab_spanner(
    label = 'Indice di dipendenza',
    columns = c(Giovanile, Vecchiaia, `Complessivo`)
  ) |> 
  tab_source_note(
    source_note = 'Dati Demo.Istat'
  ) |> 
  cols_align(
    align = 'center',
    columns = 3:9
  ) |>
  cols_align(
    align = 'left',
    columns = 1:2
  ) |> 
  tab_options(table.background.color = 'white',
              table.font.style = 'Roboto',
              table.border.top.color = 'white',
              heading.align = 'center',
              row.striping.include_stub =FALSE,
              heading.border.bottom.color = "white",
              row_group.border.bottom.color = "white",
              row_group.border.top.color = "white"
              )
```

## Migrazioni

Il bilancio migratorio umbro dei 22 anni fra il 2002 e il 2024 è generalmente positivo. Trainato da un incostante ma significativo fenomeno immigratorio con l'estero, il saldo migratorio totale dell'Umbria è ulteriormente maggiorato da un saldo migratorio interno generalmente positivo fino al 2013. Fra il 2013 e il 2015, l'Umbria vive l'unico periodo emigratorio della sua storia recente, per poi registrare una generale tendenza al rialzo fino ad oggi.

## Saldi migratori

In generale, l'andamento del saldo migratorio umbro va a pari passo con quello nazionale, caratterizzato da due picchi nel 2003 (in corrispondenza dell'introduzione della legge Bossi-Fini) e nel 2007 (anno di ulteriori sanatorie, contemporanee all'entrata della Romania nell'Unione Europea). È interessante l'avvallamento del saldo migratorio totale fra il 2018 e il 2020, indipendente dal saldo migratorio interno e da quello con l'estero. Il motivo di questo scoppiamento è con tutta probabilità dovuto a problemi definitori e di conteggio: Il saldo migratorio con l'estero non tiene conto di alcuni specifici fenomeni emigratori, su tutti i rimpatri. Nel 2018, per mezzo dei decreti sicurezza, c'è stato un notevole aumento di questo tipo di evento demografico, che ha causato lo scoppiamento di cui sopra, rientrato solamente nel 2022.

```{r}
#| label: Migrazione - serie storica

girafe(ggobj = inddf |> 
  filter(var == 'Saldo migratorio con l\'estero' | var == 'Saldo migratorio interno' | var == 'Saldo migratorio') |> 
  ggplot(aes(x = anno, y = value, dataid = anno, tooltip = value)) +
  geom_point_interactive(alpha = 0) +
  geom_line(data = ~. |> filter(Territorio == 'Italia' & var != 'Saldo migratorio interno')
            |> filter(var == 'Saldo migratorio'), aes(linetype = var)) +
  geom_line(data = ~. |> filter(Territorio == 'Italia' & var != 'Saldo migratorio interno')
            |> filter(var != 'Saldo migratorio'), aes(col = var)) +
  geom_line(data = ~. |> filter(Territorio == 'Umbria')
            |> filter(var == 'Saldo migratorio'), aes(linetype = var)) +
  geom_line(data = ~. |> filter(Territorio == 'Umbria')
            |> filter(var != 'Saldo migratorio'), aes(col = var)) +
  geom_line(data = ~. |> filter(var != 'Saldo migratorio'), aes(col = var)) +
  geom_hline(yintercept = 0, col = 'gray60') +
  scale_x_continuous(breaks = c(2002, 2004, 2006, 2008, 2010, 2012, 2014, 2016, 2018, 2020, 2022, 2024)) +
  labs(title = 'Saldi migratori',
       subtitle = 'Serie storica 2002-2023',
       caption = 'Dati Demo.Istat') +
  facet_wrap(~Territorio) +
  theme(legend.position = 'bottom',
        panel.background = element_blank(),
        panel.grid = element_line(colour = 'gray90'),
        legend.title = element_blank(),
        plot.title = element_text(size = 18),
        plot.subtitle = element_text(size = 12),
        strip.background = element_blank(),
        strip.text = element_text(size = 12),
        axis.ticks = element_blank(),
        axis.title = element_blank()),
  options = list(
         opts_tooltip(css = 'background-color:white;
                      color:black;
                      font-family:Helvetica;
                      font-style:empty;
                      padding:8px;
                      border-radius:10px;
                      background:rgba(255, 255, 255, 0.8);'),
         opts_hover(css = ''),
         opts_hover_inv(css = "opacity:0.3;"),
         opts_toolbar(position = 'bottomleft'),
         opts_zoom(min = .7, max = 6))
  )

```

## Fecondità

Il numero di figli per donna (tasso di fecondità totale, TFT) delle madri di nazionalità italiana in Umbria partiva nel 2002 da livelli paragonabili a quelli nazionali. L'indicatore sta però calando ad un ritmo più alto rispetto alla media nazionale, configurando un fenomeno di invecchiamento ancora più pronunciato nel medio periodo.

### Tasso di fecondità totale

Il TFT delle madri straniere è generalmente molto più alto in termini assoluti. Anche in questo sottogruppo, però, rimane vera l'osservazione di cui sopra: il TFT calcolato sulle madri straniere in Umbria cala a ritmi sensibilmente maggiori rispetto al resto d'Italia.

```{r}
#| label: Tasso di fecondità totale

girafe(ggobj = fecdf |> 
  filter(var == 'Tasso di fecondità totale, madri italiane'
         | var == 'Tasso di fecondità totale, madri straniere'
         | var == 'Tasso di fecondità totale, tutte le madri') |> 
  mutate(var = gsub('Tasso di fecondità totale, m', 'M', var, fixed = T),
         var = gsub('Tasso di fecondità totale, t', 'T', var, fixed = T)) |> 
  ggplot(aes(x = anno, y = value, dataid = anno, tooltip = value)) +
  geom_point_interactive(alpha = 0) +
  geom_line(data = ~. |> filter(var == 'Tutte le madri'), aes(linetype = var)) +
  geom_line(data = ~. |> filter(var != 'Tutte le madri'), aes(col = var)) +
  labs(title = 'Tasso di fecondità totale') +
  scale_x_continuous(breaks = c(2002, 2004, 2006, 2008, 2010, 2012, 2014, 2016, 2018, 2020, 2022, 2023)) +
  labs(title = 'Tasso di fecondità totale',
       subtitle = 'Serie storica 2002-2023',
       caption = 'Dati Demo.Istat') +
  facet_wrap(~Territorio) +
  theme(legend.position = 'bottom',
        panel.background = element_blank(),
        panel.grid = element_line(colour = 'gray90'),
        legend.title = element_blank(),
        strip.background = element_blank(),
        plot.title = element_text(size = 18),
        plot.subtitle = element_text(size = 12),
        strip.text = element_text(size = 12),
        axis.ticks = element_blank(),
        axis.title = element_blank()),
  options = list(
         opts_tooltip(css = 'background-color:white;
                      color:black;
                      font-family:Helvetica;
                      font-style:empty;
                      padding:8px;
                      border-radius:10px;
                      background:rgba(255, 255, 255, 0.8);'),
         opts_hover(css = ''),
         opts_toolbar(position = 'bottomleft'),
         opts_zoom(min = .7, max = 6))
  )

```

### Età media al parto

Forse il fattore più importante per comprendere la differenza abissale fra i TFT di cittadine italiane e straniere è l'età al primo parto. Se è vero che esiste una generalizzata tendenza verso l'alto, le madri straniere partivano nel 2002 da livelli sensibilmente più bassi (circa 27 anni contro gli oltre 30 delle madri italiane).

```{r}
#| label: Età media al parto

girafe(ggobj = fecdf |> 
  filter(Territorio == 'Umbria',
         var == 'Età media al parto, madri italiane'
         | var == 'Età media al parto, madri straniere'
         | var == 'Età media al parto, tutte le madri') |> 
  mutate(var = gsub('Età media al parto, m', 'M', var, fixed = T),
         var = gsub('Età media al parto, t', 'T', var, fixed = T)) |> 
  ggplot(aes(x = anno, y = value, dataid = anno, tooltip = value)) +
  geom_point_interactive(alpha = 0) +
  geom_line(data = ~. |> filter(var == 'Tutte le madri'), aes(linetype = var)) +
  geom_line(data = ~. |> filter(var != 'Tutte le madri'), aes(col = var)) +
  labs(title = 'Età media al parto',
       subtitle = 'Serie storica 2002-2023') +
  scale_x_continuous(breaks = c(2002, 2004, 2006, 2008, 2010, 2012, 2014, 2016, 2018, 2020, 2022, 2024)) +
  facet_wrap(~Territorio) +
  theme(legend.position = 'bottom',
        panel.background = element_blank(),
        panel.grid = element_line(colour = 'gray90'),
        legend.title = element_blank(),
        plot.title = element_text(size = 18),
        plot.subtitle = element_text(size = 12),
        strip.background = element_blank(),
        axis.ticks = element_blank(),
        axis.title = element_blank()),
  options = list(
         opts_tooltip(css = 'background-color:white;
                      color:black;
                      font-family:Helvetica;
                      font-style:empty;
                      padding:8px;
                      border-radius:10px;
                      background:rgba(255, 255, 255, 0.8);'),
         opts_hover(css = ''),
         opts_toolbar(position = 'bottomleft'),
         opts_zoom(min = .7, max = 6))
  )
```

La differenza nell'età media al primo parto fra madri straniere ed italiane diventa ancora più evidente quando si analizza la distribuzione degli indici specifici di fecondità sull'asse delle età. Nonostante sia chiaramente visibile un avvicinamento fra le due categorie, le due distribuzioni differiscono fortemente per forma e posizione: quella individuata dalle età delle madri straniere ha una media chiaramente minore e presenta una maggiore curtosi verso destra.

```{r}
#| label: 'FX ita/stra'

girafe(ggobj = FX |>
  filter(`Anno di evento` == 2013 | `Anno di evento` == 2023) |> 
  ggplot(aes(x = Età, y = FX, col = citt, dataid = Età, tooltip = FX)) +
  geom_point_interactive(alpha = 0) +
  geom_line() +
  facet_wrap(~`Anno di evento`) +
  labs(title = 'Tassi specifici di fecondità per età',
       subtitle = 'Regione Umbria',
       caption = 'Dati Demo.Istat') +
  theme(legend.position = 'bottom',
        panel.background = element_blank(),
        panel.grid = element_line(colour = 'gray90'),
        legend.title = element_blank(),
        plot.subtitle = element_text(size = 12),
        plot.title = element_text(size = 18),
        strip.background = element_blank(),
        axis.ticks = element_blank(),
        axis.title = element_blank()),
  options = list(
         opts_tooltip(css = 'background-color:white;
                      color:black;
                      font-family:Helvetica;
                      font-style:empty;
                      padding:8px;
                      border-radius:10px;
                      background:rgba(255, 255, 255, 0.8);'),
         opts_hover(css = ''),
         opts_toolbar(position = 'bottomleft'),
         opts_zoom(min = .7, max = 6))
  )
```

## Mortalità

Ad ulteriore riprova del declino demografico della regione Umbria, si noti come la sua crescita naturale presentasse valori nettamente negativi già nel 2002. La tendenza negativa nazionale si ripropone con valori assoluti più alti anche nell'Umbria odierna, dove il valore più recente arriva al -7.0.

```{r}
#| label: Mortalità - Serie storica

girafe(ggobj = inddf |>
  filter(var == 'Quoziente di mortalità' | var == 'Quoziente di natalità' | var == 'Crescita naturale') |> 
  ggplot(aes(x = anno, y = value, dataid = anno, tooltip = value)) +
  geom_line(data = ~. |> filter(var == 'Crescita naturale'), aes(linetype = var)) +
  geom_line(data = ~. |> filter(var != 'Crescita naturale'), aes(col = var)) +
  geom_point_interactive(alpha = 0) +
  geom_hline(yintercept = 0, col = 'gray60') +
  labs(title = 'Mortalità',
       subtitle = 'Serie storica 2002-2023',
       caption = 'Dati Demo.Istat') +
  facet_wrap(~Territorio) +
  scale_x_continuous(breaks = c(2002, 2004, 2006, 2008, 2010, 2012, 2014, 2016, 2018, 2020, 2022, 2024)) +
  theme(legend.position = 'bottom',
        plot.title = element_text(size = 18),
        plot.subtitle = element_text(size = 12),
        strip.text = element_text(size = 12),
        panel.background = element_blank(),
        panel.grid = element_line(colour = 'gray90'),
        legend.title = element_blank(),
        strip.background = element_blank(),
        axis.ticks = element_blank(),
        axis.title = element_blank()),
  options = list(
         opts_tooltip(css = 'background-color:white;
                      color:black;
                      font-family:Helvetica;
                      font-style:empty;
                      padding:8px;
                      border-radius:10px;
                      background:rgba(255, 255, 255, 0.8);'),
         opts_hover(css = ''),
         opts_hover_inv(css = "opacity:0.3;"),
         opts_toolbar(position = 'bottomleft'),
         opts_zoom(min = .7, max = 6))
  )
```

### Speranza di vita e mortalità

L'evoluzione recente degli indicatori di mortalità restituisce una fotografia dello stadio finale del processo di transizione demografica: la speranza di vita alla nascita e a 65 anni cresce fino a stabilizzarsi su livelli molto alti, la probabilità di morte alla nascita crolla sotto al 2,5%. È notevole lo shock in termini di mortalità causato dalla pandemia di COVID-19: nel 2020 speranza di vita e probabilità di morte balzano indietro ai livelli dei due anni precedenti, soprattutto nella popolazione maschile.

```{r}
#| label: Mortalità
#| width: 18

## Speranza di vita alla nascita per sesso
umbe0 <- umbMort |> 
  filter(Sesso == 'Maschi' & Età == 0 | Sesso == 'Femmine' & Età == 0) |> 
  ggplot(aes(x = anno, y = `Speranza di vita`, col = Sesso,
             dataid = anno, tooltip = `Speranza di vita`)) +
  geom_path(aes(group = Sesso)) +
  labs(title = 'Speranza di vita alla nascita') +
  theme(legend.position = 'bottom',
        panel.background = element_blank(),
        panel.grid = element_line(colour = 'gray90'),
        legend.title = element_blank(),
        axis.ticks = element_blank(),
        axis.title = element_blank())

## Speranza di vita a 65 anni per sesso
umbe65 <- umbMort |> 
  filter(Sesso == 'Maschi' & Età == 65 | Sesso == 'Femmine' & Età == 65) |> 
  ggplot(aes(x = anno, y = `Speranza di vita`, col = Sesso,
             dataid = anno, tooltip = `Speranza di vita`)) +
  geom_path(aes(group = Sesso)) +
  labs(title = 'Speranza di vita a 65 anni') +
  theme(legend.position = 'bottom',
        panel.background = element_blank(),
        panel.grid = element_line(colour = 'gray90'),
        legend.title = element_blank(),
        axis.ticks = element_blank(),
        axis.title = element_blank())

## Probabilità di morte alla nascita per sesso
umbq0 <- umbMort |> 
  filter(Sesso == 'Maschi' & Età == 0 | Sesso == 'Femmine' & Età == 0) |> 
  ggplot(aes(x = anno, y = `Probabilità di morte (per mille)`,
             col = Sesso, dataid = anno, tooltip = `Probabilità di morte (per mille)`)) +
  geom_path(aes(group = Sesso)) +
  labs(title = 'Probabilità di morte alla nascita') +
  theme(legend.position = 'bottom',
        panel.background = element_blank(),
        panel.grid = element_line(colour = 'gray90'),
        legend.title = element_blank(),
        axis.ticks = element_blank(),
        axis.title = element_blank())

## Patchwork
### Umbria
girafe(ggobj = umbe0 + umbe65 + umbq0 +
  plot_layout(guides = 'collect', axes = 'collect') +
  plot_annotation(caption = 'Regione Umbria, Dati Demo.Istat',
                  theme = theme(plot.title = element_text(size = 18),
        plot.subtitle = element_text(size = 12),)) & theme(legend.position = 'bottom'),
  options = list(
         opts_tooltip(css = 'background-color:white;
                      color:black;
                      font-family:Helvetica;
                      font-style:empty;
                      padding:8px;
                      border-radius:10px;
                      background:rgba(255, 255, 255, 0.8);'),
         opts_hover(css = ''),
         opts_hover_inv(css = "opacity:0.3;"),
         opts_toolbar(position = 'bottomleft'),
         opts_zoom(min = .7, max = 6)))
```

### Sopravviventi per anno

La *sconfitta* della mortalità è ulteriormente esemplificata dalla rappresentazione della curva di sopravviventi per anno, che approssima sempre più un rettangolo. Al diminuire della probabilità di morte per ogni età, il numero di sopravviventi rimane essenzialmente costante fino ad età molto avanzate. Le curve sembrano avvicinarsi anno dopo anno ad una sorta di *limite naturale* della vita umana, età a cui la probabilità di morte decolla e i sopravviventi diminuiscono drasticamente.

```{r}
#| label: 'Curva sopravviventi anno per anno'
### Umbria ----
umbMort |> 
  filter(Sesso != 'Maschi e femmine') |> 
  filter(anno == 1974 | anno == 1994 | anno == 2014) |>
  ggplot(aes(x = Età, y = Sopravviventi, linetype = anno, group = anno)) +
  geom_line() +
  facet_wrap(~Sesso) +
  labs(title = 'Curva di sopravviventi per anno',
       subtitle = 'Regione Umbria',
       caption = 'Dati Demo.Istat') +
  theme(legend.position = 'bottom',
        plot.title = element_text(size = 18),
        plot.subtitle = element_text(size = 12),
        strip.text = element_text(size = 12),
        panel.background = element_blank(),
        panel.grid = element_line(colour = 'gray90'),
        legend.title = element_blank(),
        strip.background = element_blank(),
        axis.ticks = element_blank(),
        axis.title = element_blank())
```
